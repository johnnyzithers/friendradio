/**
 * Created by serkan on 06/12/16.
 */
var bass=require('./index');
var basslib=new bass();
var ref=require('ref')
//get all sound cards
var cards=basslib.getDevices();
console.log('total found sound cards:' + cards.length)
//lets print first sound card's info, find out more inside source code..
//first item in array '[0]' is "no sound" , then use the item [1]
//you will see that card isInitialized will be false, because we did not init it yet..
var card=cards[1];
console.log(card.name + ' is enabled:' + card.enabled + ' ,IsDefault:' + card.IsDefault + ' , IsInitialized:' + card.IsInitialized + ' ,typeSpeakers:' + card.typeSpeakers)

// [device],[freq],[flags] , -1 is default sound card
var result=basslib.BASS_Init(-1,44100,basslib.BASS_Initflags.BASS_DEVICE_SPEAKERS )
if(!result){
    console.log('error init sound card:' + basslib.BASS_ErrorGetCode())
}

var refinfo=basslib.getInfo()
console.log(JSON.stringify(refinfo))
console.log("first card is init?:" + basslib.getDevice(1).IsInitialized)

// isMemoryFile,filename,offset,length,flags, returns pointer of file
var chan=basslib.BASS_StreamCreateFile(0,'music.mp3',0,0,basslib.BASS_SPEAKERtypes.BASS_SPEAKER_FRONTRIGHT)
if(basslib.BASS_ErrorGetCode()!=basslib.BASS_ErrorCode.BASS_OK){
    console.log('error opening file:' + basslib.BASS_ErrorGetCode())
}

//lets play
//channel,restart   , returns  (also there are stop , pause commands)
var success=basslib.BASS_ChannelPlay(chan,-1)
if(!success){
    console.log('error playing file:' + basslib.BASS_ErrorGetCode())
}

setInterval(function(){
    if(basslib.BASS_ChannelIsActive(chan)==basslib.BASS_ChannelIsActiveAttribs.BASS_ACTIVE_PLAYING) {


        console.log( basslib.getPosition(chan)  + ' / ' + basslib.getDuration(chan))
        var volume=ref.alloc('float');
        var sonuc=basslib.setVolume(chan,0.800)

        console.log('volume:' + basslib.getVolume(chan))
    }else{
        console.log('stopped' )
    }
},500)